import type { NextApiRequest, NextApiResponse } from 'next';
import { google } from 'googleapis';

process.env.GOOGLE_SERVICE_ACCOUNT =
  'eyAidHlwZSI6ICJzZXJ2aWNlX2FjY291bnQiLCAicHJvamVjdF9pZCI6ICJwcm9qZWN0LWlkLTU0MTAwMjY2NTM3MjEyNTU3NDMiLCAicHJpdmF0ZV9rZXlfaWQiOiAiMWIyZDRhZWM0NzQ0ZDBhMmQyODQ0MjhkNGU3MDQyMTdlZjYzNDZjNiIsICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ2g1QzVlamxEWnFjVnNcbjNub3lSNGRCZ1RPVGFtQnZuc3JwZ3ZFL2FUTE4wb1J2bGQ4TWRIMktrM1lEQlFqbnJ4dGdGVkZucy9zd2JRcVpcbldSSVQyT01ESmZVL0xtN052eENEMXkxODVBTXJiYlAxOTgzQ2p5ZC9nbERxU2tKbmhPWjFLaWlOaXc0Ri9qSnZcbnR4VWxlMDVZelRxeWtXd1MwdWM2cXZkNlluNkFPN3crcWplcWlkbklnUXc2OGtDOEJicVR3NHBsdTJzYktlbEhcbmRPcU9zSXRZMHdvSUs1WFhwaklJVFJZTktabDBrcnkyRmhKRzJzS2tNN3lHU0llK3lNWW5rbzh1WW1ucDU0bTlcbnNQK2VkSUJSUmlkSDFTNWtqWmtHUllFRWNFU2tWbDdROStubGlldWQzczB6dTNOYmtsTEduYUdPdGEwNGhtSXBcbnBpNkFSNkxKQWdNQkFBRUNnZ0VBTjBRemhEb25aYmNzVzdjemxoaVBGeENwYjhqZjlSc0xnRjRnUjVwOUtvQ1Vcbmo1ZGxWdFlweVhYLzBwWVViU3Q5Ti9idkhHejM4cGMzQ0JTOU5DTlZsRXlRQmFxdlR2UE1Db1laMUVudXZ4T3JcblhPdmt4V2VqZjBjWW9uTUphbGVYYVNZa1EvWFZxcndWc2NlWm8zc055d2o4NGRyOVB3dmF2aytCUHJtREgvazRcbitKNE0vZVZidUMySlUzVHFMMkwzRWRXaVVaT0dsZnYwaVFCSTlKc0todVBidm5oeURmRloyYnhyem40dlByWTZcbjh4MjZZRUNVK2Z0dFNFcytRWlJaR0p6b0lFVnUwSTdibUh6dm5WM0U4SzM4N0lSMmdpL3RVQ0JwQStsQ3k5N2Fcbk5PVWt0dEFidEkzQkhJMk4zaDBrZFM4b0VhOGFMeG9VcFdGNTc1bkM1UUtCZ1FEZlllUjE2czU0TDBhdm55c3BcblBjRFk2QlZTVW8zRlVFdW9kdkNQbXMzY0dBZWRFYkxhR1JtZGpZdFlrWXp1ZFFDb05xS1hTZDNJQ1lyYmZzTGhcbnZNR3BUOWpYSW9sSXI3dUUxVjhGOXVaVEY4ZXNyMnpicmI0bjU0c3dISVBOek90TjdqQ0lKY1R5Vm5OWVFlbUlcbjJZSEY5akk1QUZ2MElOQ3N4WXpYWU83VXB3S0JnUUM1aDd1TEUvU0hZQVpRN1FuaWk4VHpYODlEU1RqdGpabDlcbmRhVFJXUnJMNGZla296YjlzWlNPeE04RXZ6TytscjNmdGRReWRJKzJrcVU1MDBnYTZxVGxKelEvS3NncjFadlhcbitDbHNHK2lMZ1NpTklFM1ZiNGZtQTcwSnBwSzhqdXhsNnIwY2JvZmFxY0FLNTVzVVZXMkpIVkVRc1NVT0tneURcbllmSklybW9MRHdLQmdFdmM0Z3JOMkpybWExb2ZjemdKV2VJUVI1VnlwZVVaMU9mOHBNd1FaZE5XY2RkOCtFR3JcbmZwQ01Ub09nd3IwRkRWa1RYUHFHUW9TNkFPZDBVRmo3a3NXZWNXVDJ2S3JyeTRKY09HNDlJSkdkcE5sWHBsK2dcbnpOQ2VpUjJvd1haMkhuK1Q0ZldLNWl6ckFUYzdBMFhQb0l3TGhaam9MMUpraHBuMmFWT0gvdlJIQW9HQUJJRy9cbmxJbFBqMXBOelBsMUhBTzVMUkJPd0p1dXZsYUtPL24zbnY1RElHREUyMEw3dXYzdFZlcUIvT09JSmtFVEs3UUhcbkM1SzVTdjRVOVdxa2ZjTGxib3VkUVV1UXdUL1hJVS90OGFwYjQ4ZW5iSVkwWGRMdndpNmxFTzd5OFpHblBIS1BcblZYbDU0MTNzUkZlTDlOcCtacTVIb2RncnhrUlBPWUhQbU9SanZ4RUNnWUVBaGM3UHhwS052T2hZbHRZTUdVMGlcbjU1aGhrRXdMVG9kdTlTUC9LMmtPQmJNamppd0cyZ0FrQjhOSkdOZmxWWkdJNkovdXhFQzNKekI1ajBSWUo0MENcbjlsQ3JxTTJBbE55cUh0RjNBY1AwNERnL2RCbUU0SVB6M2FjUnY3Wm5POWtZbnRJbzFWVkwyR0RCTyswNmNDTWZcblRzZHI5eHBxY3JlRGNrcFY0UjhiSjM4PVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwgImNsaWVudF9lbWFpbCI6ICJjYWx2YXJ5LXNoZWV0cy1jYWxlbmRhckBwcm9qZWN0LWlkLTU0MTAwMjY2NTM3MjEyNTU3NDMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCAiY2xpZW50X2lkIjogIjEwNjA4MTQ4MDMyNDk5MjYyNTM3NCIsICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLCAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2NhbHZhcnktc2hlZXRzLWNhbGVuZGFyJTQwcHJvamVjdC1pZC01NDEwMDI2NjUzNzIxMjU1NzQzLmlhbS5nc2VydmljZWFjY291bnQuY29tIiB9';

const SHEET_ID = '1PyITnQGRqwbYcsXIZNC2sANFlmKrY3SIgV7wKGW3X88';

export type GoogleSheetRow = string[];

export default async function handler(req: NextApiRequest, res: NextApiResponse<{ events: GoogleSheetRow[] }>) {
  const auth = await google.auth.getClient({
    credentials: JSON.parse(Buffer.from(process.env.GOOGLE_SERVICE_ACCOUNT as string, 'base64').toString('ascii')),
    scopes: ['https://www.googleapis.com/auth/spreadsheets.readonly'],
  });

  const sheets = google.sheets({ version: 'v4', auth });

  const response = await sheets.spreadsheets.values.get({
    spreadsheetId: SHEET_ID,
    range: `Calendar!A3:E1000`,
  });

  const events = response.data.values as GoogleSheetRow[];

  res.status(200).json({ events });
}
